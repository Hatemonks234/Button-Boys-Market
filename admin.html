<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>TB3 Admin</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<script>
  const pass = prompt("Admin password:");
  if (pass !== "HiPanda77") {
    alert("Access denied");
    window.location.replace("index.html");
  }
</script>

<header class="navbar">
  <div class="logo">TB3 Admin</div>
  <nav>
    <a href="product.html">Back to Shop</a>
    <a href="https://discord.gg/1342460566958247936" target="_blank">Discord</a>
  </nav>
</header>

<main class="container">

  <h2>Stock Control</h2>

  <input
    id="stockInput"
    type="number"
    min="0"
    placeholder="Enter stock amount"
  />
  <button onclick="updateStock()">Update Stock</button>

  <p id="currentStock"></p>

  <hr />

  <h2>Orders</h2>
  <ul id="orderList"></ul>

</main>

<script src="script.js"></script>

<script>
  function updateStock() {
    const val = parseInt(document.getElementById("stockInput").value);
    if (isNaN(val) || val < 0) {
      alert("Invalid stock amount");
      return;
    }
    setStock(val);
    loadAdmin();
  }

  function endOrder(index) {
    let orders = JSON.parse(localStorage.getItem("tb3_orders")) || [];
    orders.splice(index, 1);
    localStorage.setItem("tb3_orders", JSON.stringify(orders));

    let stock = getStock();
    if (stock > 0) setStock(stock - 1);

    loadAdmin();
  }

  function loadAdmin() {
    document.getElementById("currentStock").textContent =
      "Current stock: " + getStock();

    const orders = JSON.parse(localStorage.getItem("tb3_orders")) || [];
    const list = document.getElementById("orderList");
    list.innerHTML = "";

    if (orders.length === 0) {
      list.innerHTML = "<li>No orders yet</li>";
      return;
    }

    orders.forEach((o, i) => {
      const li = document.createElement("li");
      li.innerHTML = `
        <strong>${o.id}</strong><br>
        Discord: ${o.discord}<br>
        Time: ${o.time}<br>
        <button onclick="endOrder(${i})">End Order</button>
      `;
      list.appendChild(li);
    });
  }

  loadAdmin();
</script>

</body>
</html>
